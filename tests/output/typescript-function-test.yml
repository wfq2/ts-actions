name: TypeScript Function Test
on:
  push:
    branches:
      - main
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "24"
      - name: Checkout code
        uses: actions/checkout@v4
      - name: Run TypeScript function
        run: >-
          node << 'TS_ACTIONS_EOF'

          // Enhanced error handling with source map support

          const originalError = Error;

          Error.prepareStackTrace = function(error, stack) {
            // Try to map stack traces back to original source
            return stack.map(frame => {
              const fileName = frame.getFileName();
              const lineNumber = frame.getLineNumber();
              const columnNumber = frame.getColumnNumber();
              const functionName = frame.getFunctionName();
              
              // Provide clear error context
              return `    at ${functionName || '<anonymous>'} (${fileName}:${lineNumber}:${columnNumber})`;
            }).join('\n');
          };


          try {
            // Create module object for CommonJS compatibility
            const module = { exports: {} };
            const exports = module.exports;
            
            // Error handling wrapper
            const originalConsoleError = console.error;
            console.error = function(...args) {
              originalConsoleError.apply(console, args);
            };
            
            // tests/workflows/typescript-function.ts
            module.exports = (inputValue, threshold) => {
              const value = Number.parseInt(inputValue, 10);
              if (value > threshold) {
                console.log(`Value ${value} exceeds threshold ${threshold}`);
                process.exit(1);
              }
              console.log(`Value ${value} is within threshold ${threshold}`);
              process.exit(0);
            };
            //# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsidGVzdHMvd29ya2Zsb3dzL3R5cGVzY3JpcHQtZnVuY3Rpb24udHMiXSwKICAic291cmNlc0NvbnRlbnQiOiBbIlxuXG5cbi8vIEV4cG9ydCB0aGUgZnVuY3Rpb25cbm1vZHVsZS5leHBvcnRzID0gKGlucHV0VmFsdWU6IHN0cmluZywgdGhyZXNob2xkOiBudW1iZXIpOiB2b2lkID0+IHtcbiAgICBjb25zdCB2YWx1ZSA9IE51bWJlci5wYXJzZUludChpbnB1dFZhbHVlLCAxMCk7XG4gICAgaWYgKHZhbHVlID4gdGhyZXNob2xkKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGBWYWx1ZSAke3ZhbHVlfSBleGNlZWRzIHRocmVzaG9sZCAke3RocmVzaG9sZH1gKTtcbiAgICAgICAgcHJvY2Vzcy5leGl0KDEpO1xuICAgIH1cbiAgICBjb25zb2xlLmxvZyhgVmFsdWUgJHt2YWx1ZX0gaXMgd2l0aGluIHRocmVzaG9sZCAke3RocmVzaG9sZH1gKTtcbiAgICBwcm9jZXNzLmV4aXQoMCk7XG59O1xuIl0sCiAgIm1hcHBpbmdzIjogIjs7Ozs7OztBQUlBLE9BQU8sVUFBVSxDQUFDLFlBQW9CLGNBQTRCO0FBQzlELFFBQU0sUUFBUSxPQUFPLFNBQVMsWUFBWSxFQUFFO0FBQzVDLE1BQUksUUFBUSxXQUFXO0FBQ25CLFlBQVEsSUFBSSxTQUFTLEtBQUssc0JBQXNCLFNBQVMsRUFBRTtBQUMzRCxZQUFRLEtBQUssQ0FBQztBQUFBLEVBQ2xCO0FBQ0EsVUFBUSxJQUFJLFNBQVMsS0FBSyx3QkFBd0IsU0FBUyxFQUFFO0FBQzdELFVBQVEsS0FBSyxDQUFDO0FBQ2xCOyIsCiAgIm5hbWVzIjogW10KfQo=
            
            
            // Execute the function
            (async () => {
              try {
                const fn = module.exports;
                
                if (!fn || typeof fn !== 'function') {
                  throw new Error('Function not found in bundle. Expected module.exports to contain a function.');
                }
                
                const result = await fn("100", 50);
                if (result !== undefined) {
                  console.log(result);
                }
                process.exit(0);
              } catch (error) {
                console.error("Error executing function:", error);
                if (error instanceof Error) {
                  console.error("Stack trace:", error.stack);
                }
                process.exit(1);
              }
            })();
          } catch (error) {
            console.error("Error in TypeScript function:", error.message);
            if (error.stack) {
              console.error("Stack trace:");
              console.error(error.stack);
            }
            process.exit(1);
          }

          TS_ACTIONS_EOF
run-name: "${{ github.workflow }}: ${{ github.event.head_commit.message }} by
  @${{ github.actor }}"
