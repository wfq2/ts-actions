name: Simple TypeScript Function Test
on:
  push:
    branches:
      - main
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "24"
      - name: Checkout code
        uses: actions/checkout@v4
      - name: Run TypeScript function
        run: >-
          node << 'TS_ACTIONS_EOF'

          // Enhanced error handling with source map support

          const originalError = Error;

          Error.prepareStackTrace = function(error, stack) {
            // Try to map stack traces back to original source
            return stack.map(frame => {
              const fileName = frame.getFileName();
              const lineNumber = frame.getLineNumber();
              const columnNumber = frame.getColumnNumber();
              const functionName = frame.getFunctionName();
              
              // Provide clear error context
              return `    at ${functionName || '<anonymous>'} (${fileName}:${lineNumber}:${columnNumber})`;
            }).join('\n');
          };


          try {
            // Create module object for CommonJS compatibility
            const module = { exports: {} };
            const exports = module.exports;
            
            // Error handling wrapper
            const originalConsoleError = console.error;
            console.error = function(...args) {
              originalConsoleError.apply(console, args);
            };
            
            // tests/workflows/simple-typescript-function.ts
            module.exports = () => console.log("Hello, world!");
            //# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsidGVzdHMvd29ya2Zsb3dzL3NpbXBsZS10eXBlc2NyaXB0LWZ1bmN0aW9uLnRzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyJcblxuXG4vLyBFeHBvcnQgdGhlIGZ1bmN0aW9uXG5tb2R1bGUuZXhwb3J0cyA9ICgpID0+IGNvbnNvbGUubG9nKFwiSGVsbG8sIHdvcmxkIVwiKTtcbiJdLAogICJtYXBwaW5ncyI6ICI7Ozs7Ozs7QUFJQSxPQUFPLFVBQVUsTUFBTSxRQUFRLElBQUksZUFBZTsiLAogICJuYW1lcyI6IFtdCn0K
            
            
            // Execute the function
            (async () => {
              try {
                const fn = module.exports;
                
                if (!fn || typeof fn !== 'function') {
                  throw new Error('Function not found in bundle. Expected module.exports to contain a function.');
                }
                
                const result = await fn();
                if (result !== undefined) {
                  console.log(result);
                }
                process.exit(0);
              } catch (error) {
                console.error("Error executing function:", error);
                if (error instanceof Error) {
                  console.error("Stack trace:", error.stack);
                }
                process.exit(1);
              }
            })();
          } catch (error) {
            console.error("Error in TypeScript function:", error.message);
            if (error.stack) {
              console.error("Stack trace:");
              console.error(error.stack);
            }
            process.exit(1);
          }

          TS_ACTIONS_EOF
